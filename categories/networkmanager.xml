<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Milosophical Me (NetworkManager)</title><link>http://milosophical.me/</link><description></description><language>en</language><lastBuildDate>Fri, 23 Jan 2015 22:36:10 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>DNS Caching in Ubuntu Desktop</title><link>http://milosophical.me/blog/2013/02/24/dns-caching-in-ubuntu-desktop.html</link><dc:creator>Mike Lockhart</dc:creator><description>&lt;p&gt;In a &lt;a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/"&gt;previous blog entry&lt;/a&gt; I described setting up a caching-only DNS server to speed up hostname resolution on Debian systems.  I've recently been playing with Ubuntu and noticed that this hack is not working.


&lt;!--more--&gt;



Some investigation lead me to two blog entries.

&lt;/p&gt;&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://www.stgraber.org/2012/02/24/dns-in-ubuntu-12-04/"&gt;This describes changes to DNS in Ubuntu 12.04 and their rationalle&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="http://sokratisg.net/2012/03/31/ubuntu-precise-12-04-get-rid-of-nms-dnsmasq-and-setup-your-own/"&gt;This blog entry describes dsnmasq&lt;/a&gt; and how to switch NetworkManager to use your own dnsmasq setup.&lt;/li&gt;
&lt;/ul&gt;

I have found that I can continue to use my own bind9 setup (not wishing to learn about &lt;a href="http://linux.die.net/man/8/dnsmasq"&gt;dnsmasq(8)&lt;/a&gt; today) by combining sugestions from the two blogs.

&lt;ol&gt;
	&lt;li&gt;Setup DNS caching server per &lt;a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/"&gt;my existing procedure for Debian&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;edit &lt;code&gt;&lt;strong&gt;/etc/NetworkManager/NetworkManager.conf&lt;/strong&gt;&lt;/code&gt; and comment out (with a &lt;strong&gt;&lt;code&gt;#&lt;/code&gt;&lt;/strong&gt;) the line &lt;code&gt;&lt;strong&gt;dns=dnsmasq&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;edit &lt;code&gt;&lt;strong&gt;/etc/resolvconf/resolv.conf.d/head&lt;/strong&gt;&lt;/code&gt; and add the line &lt;code&gt;&lt;strong&gt;nameserver=127.0.0.1&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;&lt;code&gt;&lt;strong&gt;sudo restart network-manager&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

Now test it:

&lt;blockquote&gt;&lt;code&gt;&lt;pre&gt;

mjl@hoppy:~$ &lt;strong&gt;time nslookup australia.gov.au&lt;/strong&gt;

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



&lt;strong&gt;real    0m0.630s&lt;/strong&gt;

user    0m0.008s

sys     0m0.000s

mjl@hoppy:~$ &lt;strong&gt;time nslookup australia.gov.au&lt;/strong&gt;

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



&lt;strong&gt;real    0m0.012s&lt;/strong&gt;

user    0m0.000s

sys     0m0.008s

&lt;/pre&gt;&lt;/code&gt;&lt;/blockquote&gt;

The (real) time dropped from nearly 2/3 of a second to under 1/64 seconds!

Once again visiting sites with lots of DNS lookups is improved dramatically.</description><category>DNS</category><category>NetworkManager</category><category>hacking</category><category>howto</category><category>networks</category><category>ubuntu</category><guid>http://milosophical.me/blog/2013/02/24/dns-caching-in-ubuntu-desktop.html</guid><pubDate>Sun, 24 Feb 2013 00:32:32 GMT</pubDate></item></channel></rss>