<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Milosophical Me (DNS)</title><link>http://milosophical.me/</link><description></description><language>en</language><lastBuildDate>Fri, 23 Jan 2015 22:36:10 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>DNS Caching in Ubuntu Desktop</title><link>http://milosophical.me/blog/2013/02/24/dns-caching-in-ubuntu-desktop.html</link><dc:creator>Mike Lockhart</dc:creator><description>&lt;p&gt;In a &lt;a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/"&gt;previous blog entry&lt;/a&gt; I described setting up a caching-only DNS server to speed up hostname resolution on Debian systems.  I've recently been playing with Ubuntu and noticed that this hack is not working.


&lt;!--more--&gt;



Some investigation lead me to two blog entries.

&lt;/p&gt;&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://www.stgraber.org/2012/02/24/dns-in-ubuntu-12-04/"&gt;This describes changes to DNS in Ubuntu 12.04 and their rationalle&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="http://sokratisg.net/2012/03/31/ubuntu-precise-12-04-get-rid-of-nms-dnsmasq-and-setup-your-own/"&gt;This blog entry describes dsnmasq&lt;/a&gt; and how to switch NetworkManager to use your own dnsmasq setup.&lt;/li&gt;
&lt;/ul&gt;

I have found that I can continue to use my own bind9 setup (not wishing to learn about &lt;a href="http://linux.die.net/man/8/dnsmasq"&gt;dnsmasq(8)&lt;/a&gt; today) by combining sugestions from the two blogs.

&lt;ol&gt;
	&lt;li&gt;Setup DNS caching server per &lt;a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/"&gt;my existing procedure for Debian&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;edit &lt;code&gt;&lt;strong&gt;/etc/NetworkManager/NetworkManager.conf&lt;/strong&gt;&lt;/code&gt; and comment out (with a &lt;strong&gt;&lt;code&gt;#&lt;/code&gt;&lt;/strong&gt;) the line &lt;code&gt;&lt;strong&gt;dns=dnsmasq&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;edit &lt;code&gt;&lt;strong&gt;/etc/resolvconf/resolv.conf.d/head&lt;/strong&gt;&lt;/code&gt; and add the line &lt;code&gt;&lt;strong&gt;nameserver=127.0.0.1&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;&lt;code&gt;&lt;strong&gt;sudo restart network-manager&lt;/strong&gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

Now test it:

&lt;blockquote&gt;&lt;code&gt;&lt;pre&gt;

mjl@hoppy:~$ &lt;strong&gt;time nslookup australia.gov.au&lt;/strong&gt;

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



&lt;strong&gt;real    0m0.630s&lt;/strong&gt;

user    0m0.008s

sys     0m0.000s

mjl@hoppy:~$ &lt;strong&gt;time nslookup australia.gov.au&lt;/strong&gt;

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



&lt;strong&gt;real    0m0.012s&lt;/strong&gt;

user    0m0.000s

sys     0m0.008s

&lt;/pre&gt;&lt;/code&gt;&lt;/blockquote&gt;

The (real) time dropped from nearly 2/3 of a second to under 1/64 seconds!

Once again visiting sites with lots of DNS lookups is improved dramatically.</description><category>DNS</category><category>NetworkManager</category><category>hacking</category><category>howto</category><category>networks</category><category>ubuntu</category><guid>http://milosophical.me/blog/2013/02/24/dns-caching-in-ubuntu-desktop.html</guid><pubDate>Sun, 24 Feb 2013 00:32:32 GMT</pubDate></item><item><title>Implementing a caching-only DNS on Debian</title><link>http://milosophical.me/blog/2012/01/11/implementing-a-caching-only-dns-on-debian.html</link><dc:creator>Mike Lockhart</dc:creator><description>&lt;p&gt;After 3 years of sticking with Novell, I recently switched away from openSUSE to &lt;a title="Debian GNU/Linux" href="http://www.debian.org" target="_blank"&gt;Debian&lt;/a&gt;. There are a few reasons why, but I won't bore you with them. So far I'm liking it. There are a few things to set up before I settle in, and one is slow DNS lookup.


&lt;!--more--&gt;



I described how and why to make a &lt;a title="Implementing a caching-only DNS on openSUSE" href="http://sinewalker.wordpress.com/2010/07/20/implementing-a-caching-only-dns-on-opensuse/"&gt;caching-only DNS on openSUSE&lt;/a&gt; in July 2010.  In Debian it's a little different:

&lt;/p&gt;&lt;ol&gt;
	&lt;li&gt;Install bind of course. The package is called &lt;em&gt;bind9 &lt;/em&gt;and installs itself as a service and starts automatically, no need to mess with runlevels:
         &lt;div&gt;
          &lt;code&gt;
# &lt;strong&gt;aptitude install bind9&lt;/strong&gt;


          &lt;/code&gt;
         &lt;/div&gt;
        &lt;/li&gt;
	&lt;li&gt;The config for bind in Debian is a subdirectory structure in &lt;code&gt;/etc/bind&lt;/code&gt;.  For a simple caching-only server, you leave /etc/bind/named.conf untouched and instead change &lt;code&gt;&lt;strong&gt;/etc/bind/named.conf.options&lt;/strong&gt;&lt;/code&gt; to have your &lt;em&gt;forwarders&lt;/em&gt;:
        &lt;div&gt;
          &lt;code&gt;
// MJL20120111 - Adding Google2, OpenDNS1, gateway

forwarders {
    8.8.4.4; 208.67.222.222; 192.168.1.1;
};


          &lt;/code&gt;
         &lt;/div&gt;
        &lt;/li&gt;
	&lt;li&gt;Restart bind to load the new configuration:
         &lt;div&gt;
          &lt;code&gt;
# &lt;strong&gt;service bind9 restart&lt;/strong&gt;


          &lt;/code&gt;
         &lt;/div&gt;
        &lt;/li&gt;
	&lt;li&gt;You will need to change your network to use the local bind. I used &lt;a title="NetworkManager's home page" href="http://projects.gnome.org/NetworkManager/"&gt;NetworkManager&lt;/a&gt; on the GNOME desktop, but you can just edit &lt;strong&gt;&lt;code&gt;/etc/resolv.conf&lt;/code&gt;&lt;/strong&gt;:
         &lt;div&gt;
          &lt;code&gt;
nameserver 127.0.0.1 #local bind


          &lt;/code&gt;
         &lt;/div&gt;
If you edit the file by hand, you'll have to restart the network somehow (haven't found out how yet, except with NetworkManager).&lt;/li&gt;
	&lt;li&gt;Done. Test it:
         &lt;div&gt;
          &lt;code&gt;
$ &lt;strong&gt;nslookup australia.gov.au&lt;/strong&gt;

Server:127.0.0.1

Address:127.0.0.1#53Non-authoritative answer:

Name:australia.gov.au

Address: 205.239.168.12


          &lt;/code&gt;
         &lt;/div&gt;
        &lt;/li&gt;
&lt;/ol&gt;

All good, and much faster. Happy surfing.</description><category>DNS</category><category>bind</category><category>debian</category><category>hacking</category><category>network</category><guid>http://milosophical.me/blog/2012/01/11/implementing-a-caching-only-dns-on-debian.html</guid><pubDate>Wed, 11 Jan 2012 03:35:59 GMT</pubDate></item><item><title>Implementing a caching-only DNS on openSUSE</title><link>http://milosophical.me/blog/2010/07/20/implementing-a-caching-only-dns-on-opensuse.html</link><dc:creator>Mike Lockhart</dc:creator><description>&lt;p&gt;Lately I've been noticing significant DNS latency when visiting certain sites. This is most obvious when my browser spends ages with "Looking up some.web.server.com..." in it's status bar. It's particularly bad at sites like &lt;em&gt;wordpress.com&lt;/em&gt; where many pages make reference to sub-domains of wordpress.com and typically also to &lt;em&gt;google.com&lt;/em&gt; for analytics or ads.


While my ISP's DNS infrastructure is pretty good, there are a couple of things I can do to improve DNS look-up, which makes page loads a lot quicker.

&lt;!--more--&gt;

There are two things which can significantly speed up DNS look-ups for your local clients:

&lt;/p&gt;&lt;ul&gt;
	&lt;li&gt;Switch to a faster name service&lt;/li&gt;
	&lt;li&gt;Cache your look-ups on your machine, to prevent repeat DNS requests for sites you often visit&lt;/li&gt;
&lt;/ul&gt;

Of course, a combination works well too.



So, what name service do you use? I know of two free/open services that are pretty good and promising to get better:

&lt;ul&gt;
	&lt;li&gt;&lt;a title="OpenDNS" href="http://www.opendns.com/"&gt;OpenDNS&lt;/a&gt;: This is a globally distributed service that's fairly quick and is free to use. It also offers a simple (and easily bypassed) content filtering service by blocking known domain names&lt;/li&gt;
	&lt;li&gt;&lt;a title="Google Public DNS" href="http://code.google.com/speed/public-dns/"&gt;Google Public DNS&lt;/a&gt;: This is a recent service offered by Google as an experiment in DNS technologies. Again it's globally distributed (using any-cast so the same IP routes to the Google data centre closest to you). No filtering is provided&lt;/li&gt;
&lt;/ul&gt;

Both are great services. &lt;a title="Unixmen: Google vs OpenDNS" href="http://www.unixmen.com/news-today/612-opendns-vs-google-dns"&gt;Performance varies depending on where in the world you are&lt;/a&gt;.  Since I'm in Australia, Google beats OpenDNS, but I'm going to use both of these and my ISP since it's still fairly good too.

&lt;h2&gt;Hack 0: install and configure BIND&lt;/h2&gt;

In openSUSE, you can install &lt;a title="(Wikipedia)" href="http://en.wikipedia.org/wiki/BIND"&gt;bind&lt;/a&gt; like this (as root):

&lt;pre style="padding-left:30px;"&gt;&lt;code&gt;# &lt;strong&gt;zypper install bind&lt;/strong&gt;

&lt;/code&gt;&lt;/pre&gt;

Although the program is called &lt;a title="Internet Systems Consortium's page about BIND" href="http://www.isc.org/software/bind"&gt;BIND&lt;/a&gt;, &lt;a title="Off-topic: interesting diversion in application of use-mention in various fields. It comes up quite a lot in computers :)" href="http://www.google.com/search?q=%22the+name+of+the+song%22+haddocks+eyes"&gt;the name of the service is&lt;/a&gt; actually &lt;a title="TLDP, NAG2, Running named" href="http://tldp.org/LDP/nag2/x-087-2-resolv.named.html"&gt;named&lt;/a&gt; (name daemon). It's configured with the file &lt;strong&gt;&lt;code&gt;/etc/named.conf&lt;/code&gt;&lt;/strong&gt;. Edit this (as root) to add a list of up to three forwarding DNS name servers. I'm going with Google as Primary, then OpenDNS, then my router (which forwards to my ISP):

&lt;pre style="padding-left:30px;"&gt;&lt;code&gt;forwarders { 8.8.4.4; 208.67.222.222; 16.1.1.1; };

&lt;/code&gt;&lt;/pre&gt;

Next, you need to tell openSUSE to start the DNS server at boot time. It makes sense to have it running whenever there are network services. In openSUSE, this means at &lt;a title="(Wikipedia) - what's a runlevel" href="http://en.wikipedia.org/wiki/Runlevel"&gt;runlevels&lt;/a&gt; 3 and 5. I use &lt;a title="Yet another Setup Tool - the reason I still run openSUSE" href="http://chorgan.provo.novell.com/yast/doc/SL11.1/"&gt;YaST&lt;/a&gt; because it's so simple:

&lt;pre style="padding-left:30px;"&gt;&lt;code&gt;# &lt;strong&gt;yast2 runlevel&lt;/strong&gt;

&lt;/code&gt;&lt;/pre&gt;

Finally, start the server. Either do it from YaST, or with the command-line:

&lt;pre style="padding-left:30px;"&gt;&lt;code&gt;# &lt;strong&gt;service named start&lt;/strong&gt;

&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;Hack 1: local resolver&lt;/h2&gt;

This is simple: add the nameserver addresses to your &lt;code&gt;&lt;strong&gt;/etc/resolv.conf&lt;/strong&gt;&lt;/code&gt;, like so:

&lt;pre style="padding-left:30px;"&gt;&lt;code&gt;nameserver 127.0.0.1      # Localhost bind

nameserver 8.8.4.4        # Google

nameserver 208.67.222.222 # OpenDNS

nameserver 16.1.1.1       # My router (forwards requests to my ISP)

&lt;/code&gt;

&lt;/pre&gt;

There are alternate addresses for each of Google and OpenDNS, I've chosen one each above. The other addresses are &lt;strong&gt;8.8.8.8&lt;/strong&gt; for Google, and &lt;strong&gt;208.67.220.220&lt;/strong&gt; for OpenDNS. OpenDNS also offers "family shield" on &lt;strong&gt;.123&lt;/strong&gt; but your teenager (or maybe your six-year-old?)  can bypass that pretty easily.

&lt;h2&gt;Other computers&lt;/h2&gt;

Now, any time your browser makes a DNS look-up, the resolv.conf tells it to try your local DNS server first, which in turn forwards to Google, OpenDNS and the router, and caches the results for next time.



If you want other machines in your house to use this name server, &lt;a title="Configuring nameservers for different operating systems - use your own address instead of FamilyShield" href="https://store.opendns.com/familyshield/setup/computer"&gt;just configure them&lt;/a&gt;. If you point their primary DNS server at your openSUSE box's address, they will use the same named you just configured.</description><category>DNS</category><category>hacking</category><category>how-to</category><category>openSUSE</category><category>public DNS</category><guid>http://milosophical.me/blog/2010/07/20/implementing-a-caching-only-dns-on-opensuse.html</guid><pubDate>Tue, 20 Jul 2010 01:07:54 GMT</pubDate></item></channel></rss>