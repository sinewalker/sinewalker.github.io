<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Overview of my Python virtualenv-wrapper work-alike shell functions">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python Virtualenv wrapper functions | Milosophical Me</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#e37f2a;">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://milosophical.me/blog/2019/python-virtualenv-wrappers.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Michael Lockhart">
<link rel="prev" href="../2018/ssh-pass.html" title="ssh-pass" type="text/html">
<meta property="og:site_name" content="Milosophical Me">
<meta property="og:title" content="Python Virtualenv wrapper functions">
<meta property="og:url" content="http://milosophical.me/blog/2019/python-virtualenv-wrappers.html">
<meta property="og:description" content="Overview of my Python virtualenv-wrapper work-alike shell functions">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-02-24T07:39:54+11:00">
<meta property="article:tag" content="bash">
<meta property="article:tag" content="code">
<meta property="article:tag" content="hax">
<meta property="article:tag" content="howto">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://milosophical.me/">

                <span id="blog-title">Milosophical Me</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" role="navigation" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Navigate <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../index.html">Blog</a>
                    </li>
<li>
<a href="../../archive/archive.html">Archive</a>
                    </li>
<li>
<a href="../../tags/index.html">Tags</a>
                    </li>
<li>
<a href="../../pg/index.html">Codex</a>
                    </li>
<li>
<a href="../../pixels/index.html">Pixels</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Social <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://gist.github.com/sinewalker">Gists - Microblog</a>
                    </li>
<li>
<a href="https://www.twitter.com/milo_hax">Tweets - Nanoblog</a>
                    </li>
<li>
<a href="https://www.facebook.com/sinewalker">Facebook - Necessary Evil</a>
                    </li>
<li>
<a href="mailto:sinewalker@gmail.com">Email - So 20th Century</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Code <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://github.com/sinewalker">GitHub</a>
                    </li>
<li>
<a href="https://gist.github.com/sinewalker">Gists</a>
                    </li>
<li>
<a href="https://bitbucket.com/sinewalker">Bitbucket</a>
                    </li>
<li>
<a href="https://codepen.io/sinewalker/">Codepen</a>
                    </li>
<li class="active">
<a href="#"> <span class="sr-only">(active)</span></a>
                    </li>
<li>
<a href="https://gitlab.com/sinewalker">GitLab</a>
                    </li>
<li>
<a href="https://sourceforge.net/u/sinewalker/profile/">SourceForge</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Jargon <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../jargon/index.html">Main page</a>
                    </li>
<li>
<a href="../../jargon/html/index.html">Table of Content</a>
                    </li>
<li>
<a href="../../jargon/html/lexicon.html">Lexicon</a>
                    </li>
<li>
<a href="../../jargon/html/go01.html">Glossary</a>
                    </li>
<li>
<a href="../../jargon/html/appendixa.html">Folklore</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://about.me/mikelockhart">About.me</a>
                    </li>
<li>
<a href="https://milohax.net">Milohax.net</a>
                    </li>
<li>
<a href="https://www.linkedin.com/in/mikelockhart">LinkedIn</a>
                    </li>
<li>
<a href="http://stackoverflow.com/users/776953/mike">Stack Overflow</a>
                    </li>
<li class="active">
<a href="#"> <span class="sr-only">(active)</span></a>
                    </li>
<li>
<a href="../../pg/colophon.html">About this site</a>
                    </li>
<li>
<a href="../../rss.xml">Rich Site Summary (RSS)</a>
                    </li>
<li>
<a href="https://github.com/sinewalker/sinewalker.github.io/wiki">Meta-Wiki</a>
                    </li>
<li>
<a href="https://github.com/sinewalker/sinewalker.github.io/issues">Issues log</a>
            </li>
</ul>
</li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form navbar-right" role="search">
<input type="hidden" name="sites" value="http://milosophical.me/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="form-control"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="python-virtualenv-wrappers.md" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Python Virtualenv wrapper functions</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/michael-lockhart.html">Michael Lockhart</a>
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2019-02-24T07:39:54+11:00" itemprop="datePublished" title="2019-02-24 07:39">2019-02-24 07:39</time></a></p>
            
        <p class="sourceline"><a href="python-virtualenv-wrappers.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>A while ago I noted that I should write about my shell functions for creating and managing Python Virtual Environments. Recently I was helping my boss set up some python virtual environments for some different projects, and I couldn't remember how to use <a href="https://virtualenv.pypa.io/en/stable/">virtualenv</a> directly.</p>
<p>I <em>really wanted</em> to just share my wrappers with him, and I found that they weren't <em>quite</em> ready to share because I hadn't finished documenting them.</p>
<p>This post is to remedy that.</p>
<!-- TEASER_END -->

<hr>
<p>I have a small collection of bash functions which I use for creating and managing Python Virtual Environments with <code>virtualenv</code>.  I keep them in my <a href="https://github.com/sinewalker/dotfiles/tree/1.1.3">dotfiles</a>.  Rather than make you clone my <em>entire</em> dotfiles set up, I have modularised it down to two files which you can source. They are:</p>
<ul>
<li>
<a href="https://github.com/sinewalker/dotfiles/blob/1.1.3/source/10_meta.sh">10_meta.sh</a> (v1.1.3) - shell utility functions</li>
<li>
<a href="https://github.com/sinewalker/dotfiles/blob/1.1.3/source/50_python.sh">50_python.sh</a> (v1.1.3) - python utility functionts</li>
</ul>
<p>To use these, download the scripts to a place where you keep shell functions:</p>
<pre class="code literal-block"><span></span><span class="nb">cd</span> path/to/your/shell/library
<span class="k">for</span> X in 10_meta.sh 50_python.sh<span class="p">;</span> <span class="k">do</span>
  curl https://raw.githubusercontent.com/sinewalker/dotfiles/1.1.3/source/<span class="nv">$X</span> &gt; <span class="nv">$X</span>
<span class="k">done</span>
</pre>


<p>Then, load them into your bash like this (you can add this to your <code>.bashrc</code> somewhere so they are loaded whenever you start bash):</p>
<pre class="code literal-block"><span></span><span class="k">for</span> X in path/to/your/shell/library<span class="p">;</span> <span class="k">do</span>
  <span class="nb">source</span> <span class="nv">$X</span>
<span class="k">done</span>
</pre>


<p>Let's explore them.</p>
<h2>Make an environment</h2>
<p>One of the most useful meta-functions that you just sourced from <code>10_meta.sh</code> is <a href="https://github.com/sinewalker/dotfiles/blob/1.1.3/source/10_meta.sh#L83">describe</a>, which I talk about more fully on <a href="../2018/4-bits-part3.html">my post about Rule 6 - Doc Comments</a>.  </p>
<pre class="code literal-block"><span></span>$ describe mkvenv 
Fn: mkvenv in ./50_python.sh line <span class="m">60</span>
    <span class="s2">"Makes a Python Virtual env in </span><span class="si">${</span><span class="nv">VIRTUALENV_BASE</span><span class="si">}</span><span class="s2">."</span><span class="p">;</span>
</pre>


<p>That's interesting, all the python virtual environments will be created in <code>${VIRTUALENV_BASE}</code>.  What's this?  Well you can echo it out:</p>
<pre class="code literal-block"><span></span>$ <span class="nb">echo</span> <span class="nv">$VIRTUALENV_BASE</span>
/Users/mjl/lib/python
</pre>


<p>It's actually set in <code>50_python.sh</code> on <a href="https://github.com/sinewalker/dotfiles/blob/1.1.3/source/50_python.sh#L53">line 53</a> as the <code>python</code> sub-directory of your <code>${LIBRARY}</code> directory, if you have one, or of your <code>${HOME}/lib</code> directory if you don't.  The following line just makes sure you have that directory.  All the virtual environments will be created in this location.  </p>
<p>So <code>mkvenv</code> will create a virual environment for you:</p>
<pre class="code literal-block"><span></span>$ mkvenv
Usage: mkvenv &lt;venv&gt; <span class="o">[</span>virtualenv options<span class="o">]</span>
Makes a Python Virtual env in /Users/mjl/lib/python.
$ mkvenv myvenv
New python executable in /Users/mjl/lib/python/myvenv/bin/python2.7
Also creating executable in /Users/mjl/lib/python/myvenv/bin/python
Installing setuptools, pip, wheel...done.
</pre>


<p>Oh, that made a virtualenv with my system-default Python 2.7.</p>
<p>What if I want Python 3?</p>
<p>Well it's easy, just pass along normal virtualenv arguments after the name of the environment:</p>
<pre class="code literal-block"><span></span>$ mkvenv myvenv3 --python<span class="o">=</span>python3
Running virtualenv with interpreter /usr/local/bin/python3
New python executable in /Users/mjl/lib/python/myvenv3/bin/python3.7
Also creating executable in /Users/mjl/lib/python/myvenv3/bin/python
Installing setuptools, pip, wheel...done.
</pre>


<p>Cool.  Let's use it.  </p>
<h2>Activate an environment</h2>
<p>Activating an environment puts it in your shell <code>$PATH</code> and  adds it's name to your prompt, so you can tell that it's active.  This uses virtualenv activation scripts to do the work, just like normal:</p>
<pre class="code literal-block"><span></span>$ activate myvenv3
<span class="o">(</span>myvenv3<span class="o">)</span>$
</pre>


<p>A nice thing about my <code>activate</code> is that you don't have to remember where you installed the environment and <code>source bin/activate</code> from there. Instead it is just found for you from the relevant environment in <code>${VIRTUALENV_BASE}</code>. Very handy.</p>
<h2>Listing environments</h2>
<p>The <code>activate</code> function (and others) all use Bash TAB-completion, if you have that enabled. But maybe you're not sure what environments you have and need to see them all? Use <code>lsvenv</code> to list your environments:</p>
<pre class="code literal-block"><span></span><span class="o">(</span>myenv3<span class="o">)</span>$ lsvenv
edge-config
hax
jupyter
keras
myvenv
myvenv3
nikola
py27
sqlalchemy
te
</pre>


<p>Hmm, that <code>myvenv</code> is messy, I want to get rid of it.</p>
<h2>Removing environments</h2>
<p>Use <code>rmvenv</code> to remove an environment:</p>
<pre class="code literal-block"><span></span><span class="o">(</span>myenv3<span class="o">)</span>$ rmvenv myvenv
Remove Venv: myvenv? <span class="o">[</span>y/N<span class="o">]</span> y
$
</pre>


<h2>Deactivating an environment</h2>
<p>You can switch directly to another environment and <code>activate</code> will automatically deactivate the current one first.  But if you want to deactivate all of the virtualenv stuff <em>without</em> going to a different environment or ending your shell session, just use <code>deactivate</code> like normal:</p>
<pre class="code literal-block"><span></span><span class="o">(</span>myvenv3<span class="o">)</span>$ which python
/Users/mjl/lib/python/myvenv3/bin/python
<span class="o">(</span>myvenv3<span class="o">)</span>$ deactivate 
$ which python
/usr/local/bin/python
$ 
</pre>


<h2>Virtualenv alternative:  Anaconda</h2>
<p>I also use <a href="https://www.anaconda.com/distribution/">Anaconda Pyhton</a> a little bit, which has its own method for managing virtual environments with the <code>conda</code> tool.  But activation and deactivation is a but clunky.  So my <code>activate</code> and <code>deactivate</code> functions also work with Anaconda.</p>
<p>But now we have two <em>kinds</em> of Python virtual environments.  How is that handled?  Use <code>sucuri</code> (which is named after an Amazonian word for anaconda) to switch to Anaconda-mode. </p>
<pre class="code literal-block"><span></span>$ sucuri 
Anaconda: ACTIVATED 🐍
$
</pre>


<p>Yes, that's a UTF-8 character.  If your terminal doesn't handle that, my function takes care of you and uses ASCII instead.</p>
<blockquote>
<blockquote>
<p>Note that there's no other indication that Anaconda is active.  My <a href="https://github.com/sinewalker/dotfiles/blob/1.1.3/source/98_prompt.sh">complicated bash prompt function</a> does give you some indication by adding a snake.  If you're interested, you can go down that rabit hole. I'll leave my prompts in place for the rest of this blog post.</p>
</blockquote>
</blockquote>
<p>Anyway, you can list your environments in the same way.  This time the conda environmens are listed instead of the virtualenv ones (using <code>conda info</code> — another thing you don't need to remember):</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍<span class="o">)</span>β lsvenv 
snowflakes
root
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍<span class="o">)</span>β
</pre>


<p>Activation is the same too:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍<span class="o">)</span>β activate snowflakes 
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍-snowflakes<span class="o">)</span>β which python
/Users/mjl/lib/anaconda/envs/snowflakes/bin/python
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍-snowflakes<span class="o">)</span>β deactivate 
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍<span class="o">)</span>β
</pre>


<p>In Anaconda-mode, you can use my <code>mkvenv</code> to make a conda environment, but I don't try to wrap all the special conda commands. Use <code>conda</code> if you want to do something more sophisticated, but for basic stuff, this is fine:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:35<span class="o">](</span>🐍<span class="o">)</span>β mkvenv anotherenv
mkvenv: Warning! Anaconda is active.
This wrapper will use conda to create anotherenv, but it is only very basic.
Fetching package metadata .........
Solving package specifications: 
Package plan <span class="k">for</span> installation in environment /Users/mjl/lib/anaconda/envs/anotherenv:

Proceed <span class="o">([</span>y<span class="o">]</span>/n<span class="o">)</span>? 

<span class="c1">#</span>
<span class="c1"># To activate this environment, use:</span>
<span class="c1"># &gt; source activate anotherenv</span>
<span class="c1">#</span>
<span class="c1"># To deactivate this environment, use:</span>
<span class="c1"># &gt; source deactivate anotherenv</span>
<span class="c1">#</span>

<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:35<span class="o">](</span>🐍<span class="o">)</span>β
</pre>


<p>(Don't "use source activate anotherenv" … pfft.  Just activate anotherenv.)</p>
<p>Here's the new environment:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:35<span class="o">](</span>🐍<span class="o">)</span>β lsvenv
anotherenv
snowflakes
root
</pre>


<p>Removing it <em>is</em> a bit tricky.  My <code>rmvenv</code> just gives up.  It does tell you how you <em>might</em> want to do it with <code>conda</code> though:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:36<span class="o">](</span>🐍<span class="o">)</span>β rmvenv anotherenv
rmvenv: Warning! Anaconda is active.
Consider using <span class="s1">'conda remove -all -n anotherenv'</span> instead.
Aborting.
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:36<span class="o">](</span>🐍<span class="o">)</span> <span class="m">3</span> β 
</pre>


<p>At the end of your conda session, deactivate by running <code>sucuri</code> again:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">](</span>🐍<span class="o">)</span>β sucuri 
Anaconda: deactivated
<span class="o">[</span>mjl@milo:~/hax<span class="o">]</span>
<span class="o">[</span><span class="m">08</span>:32<span class="o">]</span>β
</pre>


<p>That's all, I hope you find these wrappers simple and easy to use. No more fumbling with virtual environment setup and management.</p>
<p>Happy hacking.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/bash.html" rel="tag">bash</a></li>
            <li><a class="tag p-category" href="../../tags/code.html" rel="tag">code</a></li>
            <li><a class="tag p-category" href="../../tags/hax.html" rel="tag">hax</a></li>
            <li><a class="tag p-category" href="../../tags/howto.html" rel="tag">howto</a></li>
            <li><a class="tag p-category" href="../../tags/python.html" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../2018/ssh-pass.html" rel="prev" title="ssh-pass">Previous post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer"><hr>Contents Copyright © 
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a>
 2005 — 2019         <a href="mailto:sinewalker@gmail.com">Michael Lockhart</a>. Powered by <a href="https://getnikola.com" rel="nofollow"><img src="../../img/nikola.png" alt="Nikola"></a>, <a href="https://github.com/syl20bnr/spacemacs"><img src="https://cdn.rawgit.com/syl20bnr/spacemacs/442d025779da2f62fc86c2082703697714db6514/assets/spacemacs-badge.svg" alt="built with Spacemacs"></a>

            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
