<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="description" content="A geek's notebook">
    <meta name="viewport" content="width=device-width">
    <title>Milosophical Me | Milosophical Me</title>

                <link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

      <link rel="canonical" href="http://milosophical.me/blog/index.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    

    
    <style>
    div.input_prompt {
      display: none;
    }
    </style>

</head>
<body>
    <section class="social">
        <ul>
                    <li><a href="../index.html" title="Home"><i class="icon-compass"></i></a></li>
            <li><a href="../archive/archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../pg/index.html" title="Codex"><i class="icon-book"></i></a></li>
            <li><a href="../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://plus.google.com/+MichaelLockhart" title="Michael+"><i class="icon-google-plus"></i></a></li>
            <li><a href="https://www.linkedin.com/in/mikelockhart" title="My LinkedIn profile"><i class="icon-linkedin"></i></a></li>
            <li><a href="https://bitbucket.com/sinewalker" title="My Bitbucket"><i class="icon-bitbucket"></i></a></li>
            <li><a href="https://github.com/sinewalker" title="My Github"><i class="icon-github"></i></a></li>
            <li><a href="http://stackoverflow.com/users/776953/mike" title="Stack Overflow"><i class="icon-stackexchange"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
        <div class="post">
            <h1 class="title"><a href="mounting-lukslvm-from-a-liveusb.html">Mounting LUKS/LVM from a LiveUSB</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-11-09T21:30:25+11:00">2014-11-09 21:30</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/mounting-lukslvm-from-a-liveusb.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/luks.html" rel="tag">LUKS</a></li>
           <li><a class="tag p-category" href="../categories/lvm.html" rel="tag">LVM</a></li>
           <li><a class="tag p-category" href="../categories/encryption.html" rel="tag">encryption</a></li>
           <li><a class="tag p-category" href="../categories/linux.html" rel="tag">linux</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>
After upgrading work's openSUSE laptop from 13.1 to 13.2 today it
would not unlock the LUKS-encrypted LVM, which is a problem since the
entire SSD is encrypted (except for /boot).  Bummer.
</p>

<p>
So, I had occasion to test my backup/recovery strategy and found that
I had a few issues (of course I did!)
</p>

<p>
One problem was: I have my work laptop backups stored to an external
USB hard drive, which is is also formatted with a LUKS encrypted
volume. Great, no problem, I just need to unlock the LUKS so I can
mount, right?  What's the password…?
</p>

<p>
Another was: my passwords are stored in a KeePass2 database, which I
have stored on a cloud service. Only: it turns out it's not been
sync'd for about 4 months because I changed the DB's location and
forgot to update the sync software, so the password for the hard drive
wasn't on the cloud. Where is it? Oh, right, it's on my broken laptop,
in an encripted LUKS/LVM which can't be unlocked since the upgrade.
Goody.
</p>

<p>
So, what to do…?
</p>

<p>
The immediate task was to locate my recovery LiveUSB. Every good
hacker should have (at least) one of these. Mine's the openSUSE 13.1
Live Rescue image, which is spartan, but it does have everything you
need, including lvm/luks on it, and yast.  Yast it turns out didn't
help me much, I'm unsure why, but anyway, I got by with the command
line ;-)
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Unlock LUKS volumes</h2>
<div class="outline-text-2" id="text-1">
<p>
To mount a LUKS-encrypted drive you first need to unlock the LUKS
container:
</p>

<div class="highlight"><pre><span class="cp"># cryptsetup luksOpen /dev/sdb1 myusb</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="k">for</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span><span class="o">:</span> 
<span class="n">No</span> <span class="n">key</span> <span class="n">available</span> <span class="n">with</span> <span class="n">this</span> <span class="n">passphrase</span><span class="p">.</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="k">for</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span><span class="o">:</span>
</pre></div>

<p>
Ah, yes. Got to get that passphrase. Of course, being in KeePass2 it's
a random generated hex string that no human will ever remember (that is what
password database are for, after all)… Well, we'll come back to
this…
</p>

<p>
So, need to unlock the volume on the laptop…
</p>

<div class="highlight"><pre><span class="cp">#cryptsetup luksOpen /dev/sda3 laptop</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="k">for</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span><span class="o">:</span>
</pre></div>

<p>
Okay, so it opened, great! (The problem after the upgrade was that it
wouldn't even get this far). Now I just need to mount the home
volume. It's part of an LVG…
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Mount the LVG(s)</h3>
<div class="outline-text-3" id="text-1-1">
<p>
First, let's look at the logical volumes:
</p>

<div class="highlight"><pre><span class="cp">#lvs</span>
  <span class="n">LV</span>   <span class="n">VG</span>   <span class="n">Attr</span>      <span class="n">LSize</span>   <span class="n">Pool</span> <span class="n">Origin</span> <span class="n">Data</span><span class="o">%</span>  <span class="n">Move</span> <span class="n">Log</span> <span class="n">Cpy</span><span class="o">%</span><span class="n">Sync</span> <span class="n">Convert</span>
  <span class="n">home</span> <span class="n">lvg</span>  <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">ao</span><span class="o">---</span> <span class="mf">179.31</span><span class="n">g</span>                                             
  <span class="n">root</span> <span class="n">lvg</span>  <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">ao</span><span class="o">---</span>  <span class="mf">50.00</span><span class="n">g</span>                                             
  <span class="n">swap</span> <span class="n">lvg</span>  <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">ao</span><span class="o">---</span>   <span class="mf">8.00</span><span class="n">g</span>
</pre></div>

<p>
That's right, I used a very simple/guessable naming
convention. Bravo. Okay, the passwords file is somewhere in 'home',
let's mount it
</p>

<div class="highlight"><pre><span class="cp"># mount /dev/laptop/home /mnt</span>
<span class="cp"># ls /mnt</span>
<span class="n">guest</span> <span class="n">mjl</span>
</pre></div>

<p>
W00t! Alright, now I can grab that KeePass database, shove it on an SD
chip and then load it up in Keepass2Android on my smart phone (the
LiveUSB doesn't have any KeePass software… hmm, better do something
about that later).
</p>

<div class="highlight"><pre><span class="c"># mkdir /var/tmp/sdc</span>
<span class="c"># mount /dev/sdc1 /var/tmp/sdc</span>
<span class="c"># cp /mnt/home/mjl/keys/db.kdbx /var/tmp/sdc</span>
<span class="c"># umount /var/tmp/sdc</span>
</pre></div>

<p>
Awesome. Now I can open up the password database, and laboriously
transcribe that generated passphrase to unlock the backup drive, when
I need to
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Long story shorter</h3>
<div class="outline-text-3" id="text-1-2">
<p>
So in a nutshell (assuming you have your password stored <i>somewhere
you can get to</i> !), you can do this:
</p>

<ol class="org-ol">
<li>Boot to a LiveUSB
</li>
<li>Start a Terminal, become root (on the Live system)
</li>
<li>
<b>tail -f /var/log/messages|grep Attached</b>
</li>
<li>Plug in the backup drive, watch which device gets attached (look
for a message like "2014-11-09T22:22:13.742555+11:00 milo kernel:
[ 4678.150011] sd 7:0:0:0: <i>[sdb]</i> Attached SCSI disk" where
<i>[sdb]</i> will be dependant on your devices, but that's the device
you're looking for
</li>
<li>unlock it <b>cryptsetup luksOpen /dev/sdb1 mybackup</b>
</li>
<li>make a mount point if necessary:  <b>mkdir /recover</b>
</li>
<li>If it's a raw partition, you can mount now <b>mount
/dev/mapper/mybackup /recover</b>, otherwise continue to LVM
</li>
<li>list the logical LVM volumes with <b>lvs</b>
</li>
<li>pick a volume (e.g. "myvolume") and mount it
</li>
</ol>

<div class="highlight"><pre><span class="c"># mount /dev/mapper/mybackup/myvolume /recover</span>
</pre></div>

<p>
Now you can navigate the volume and view/copy files.
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Unmounting</h3>
<div class="outline-text-3" id="text-1-3">
<p>
You need to first umount the volume, and then close the LUKS:
</p>

<div class="highlight"><pre><span class="c"># umount /recover</span>
<span class="c"># cryptsetup luksClose mybackup</span>
</pre></div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2013/05/24/fixing-java-ca-certificates-on-opensuse.html">Fixing Java CA Certificates on openSUSE</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-05-24T14:03:15+10:00">2013-05-24 14:03</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2013/05/24/fixing-java-ca-certificates-on-opensuse.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/certificates.html" rel="tag">certificates</a></li>
           <li><a class="tag p-category" href="../categories/fix.html" rel="tag">fix</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/java.html" rel="tag">java</a></li>
           <li><a class="tag p-category" href="../categories/opensuse.html" rel="tag">openSUSE</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>Recently switched back to openSUSE after a brief stint with Ubuntu. I guess you need to try other things out to know how good you have it, eh?  Anyway, I'm playing with <a href="https://github.com/technomancy/leiningen" title="Leiningen build tool for Clojure">Leiningen</a> and <a href="https://github.com/quil/quil" title="Quil Clojure wrapper for Processing">Quil</a>, but for some reason or other, I could not get Leiningen to self-install, because of an exception:
</p>
<pre style="text-align:center;">java.security.KeyStoreException: problem accessing trust storejava.io.IOException: Invalid keystore format</pre>

It turns out that the java keystore is somehow corrupt on OpenJDK / openSUSE 12.3. Not sure who's at fault, but here's how to fix it.

<!--more-->

<ol>

<li>Become root:

<pre>$ <strong>su -</strong>

Password:

#</pre>

</li>

<li>Verify the certificates file:

<pre># <strong>file $(readlink /usr/lib64/jvm/java-1.7.0-openjdk/jre/lib/security/cacerts)</strong>

/var/lib/ca-certificates/java-cacerts: data</pre>

</li>

<li>Oops, file should identify this as a Java KeyStore. Must be corrupt. Replace it:

<pre># <strong>rm /var/lib/ca-certificates/java-cacerts</strong>

# <strong>/usr/sbin/update-ca-certificates</strong>

creating /var/lib/ca-certificates/java-cacerts ...

144 added, 0 removed.

creating /var/lib/ca-certificates/gcj-cacerts ...

imporing AffirmTrust_Premium_ECC.pem failed: java.security.spec.InvalidKeySpecException

imporing COMODO_ECC_Certification_Authority.pem failed: java.security.spec.InvalidKeySpecException

imporing GeoTrust_Primary_Certification_Authority_G2.pem failed: java.security.spec.InvalidKeySpecException

imporing VeriSign_Class_3_Public_Primary_Certification_Authority_G4.pem failed: java.security.spec.InvalidKeySpecException

imporing thawte_Primary_Root_CA_G2.pem failed: java.security.spec.InvalidKeySpecException

2 added, 0 removed.</pre>

</li>

<li>Hmm, something's up with <em>gcj-cacerts</em> (not just all those "imporing"s, seems the PEM files are corrupted too?)... Anyway, re-verify the java-cacerts:

<pre># <strong>file /var/lib/ca-certificates/java-cacerts</strong>

/var/lib/ca-certificates/java-cacerts: Java KeyStore</pre>

</li>

<li>Good to go (sort-of?)</li>

</ol>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2013/02/24/dns-caching-in-ubuntu-desktop.html">DNS Caching in Ubuntu Desktop</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-02-24T11:32:32+11:00">2013-02-24 11:32</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2013/02/24/dns-caching-in-ubuntu-desktop.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/dns.html" rel="tag">DNS</a></li>
           <li><a class="tag p-category" href="../categories/networkmanager.html" rel="tag">NetworkManager</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/howto.html" rel="tag">howto</a></li>
           <li><a class="tag p-category" href="../categories/networks.html" rel="tag">networks</a></li>
           <li><a class="tag p-category" href="../categories/ubuntu.html" rel="tag">ubuntu</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>In a <a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/">previous blog entry</a> I described setting up a caching-only DNS server to speed up hostname resolution on Debian systems.  I've recently been playing with Ubuntu and noticed that this hack is not working.


<!--more-->



Some investigation lead me to two blog entries.

</p>
<ul>
	<li><a href="https://www.stgraber.org/2012/02/24/dns-in-ubuntu-12-04/">This describes changes to DNS in Ubuntu 12.04 and their rationalle</a></li>
	<li>
<a href="http://sokratisg.net/2012/03/31/ubuntu-precise-12-04-get-rid-of-nms-dnsmasq-and-setup-your-own/">This blog entry describes dsnmasq</a> and how to switch NetworkManager to use your own dnsmasq setup.</li>
</ul>

I have found that I can continue to use my own bind9 setup (not wishing to learn about <a href="http://linux.die.net/man/8/dnsmasq">dnsmasq(8)</a> today) by combining sugestions from the two blogs.

<ol>
	<li>Setup DNS caching server per <a href="http://sinewalker.wordpress.com/2012/01/11/implementing-a-caching-only-dns-on-debian/">my existing procedure for Debian</a>
</li>
	<li>edit <code><strong>/etc/NetworkManager/NetworkManager.conf</strong></code> and comment out (with a <strong><code>#</code></strong>) the line <code><strong>dns=dnsmasq</strong></code>
</li>
	<li>edit <code><strong>/etc/resolvconf/resolv.conf.d/head</strong></code> and add the line <code><strong>nameserver=127.0.0.1</strong></code>
</li>
	<li><code><strong>sudo restart network-manager</strong></code></li>
</ol>

Now test it:

<blockquote><code><pre>

mjl@hoppy:~$ <strong>time nslookup australia.gov.au</strong>

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



<strong>real    0m0.630s</strong>

user    0m0.008s

sys     0m0.000s

mjl@hoppy:~$ <strong>time nslookup australia.gov.au</strong>

Server:        127.0.0.1

Address:    127.0.0.1#53



Non-authoritative answer:

Name:    australia.gov.au

Address: 205.239.168.12



<strong>real    0m0.012s</strong>

user    0m0.000s

sys     0m0.008s

</pre></code></blockquote>

The (real) time dropped from nearly 2/3 of a second to under 1/64 seconds!

Once again visiting sites with lots of DNS lookups is improved dramatically.
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2012/07/31/java-virtual-memory-limits-again-2.html">Java virtual memory limits again</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-31T12:50:57+10:00">2012-07-31 12:50</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2012/07/31/java-virtual-memory-limits-again-2.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/java.html" rel="tag">java</a></li>
           <li><a class="tag p-category" href="../categories/virtual-memory.html" rel="tag">virtual memory</a></li>
           <li><a class="tag p-category" href="../categories/windows.html" rel="tag">windows</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>I think I can finally put <a title="32-bit Windows and JVM virtual memory limit" href="http://sinewalker.wordpress.com/2007/03/04/32-bit-windows-and-jvm-virtual-memory-limit">this old walnut</a> to bed, having just updated it with some observations made by guru's of Stack Overflow. Hooray, only took me four years :-P</p>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2012/05/18/windows-7-logon-background-hack.html">Windows 7 logon background hack</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-05-18T21:56:28+10:00">2012-05-18 21:56</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2012/05/18/windows-7-logon-background-hack.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/registry.html" rel="tag">registry</a></li>
           <li><a class="tag p-category" href="../categories/windows.html" rel="tag">windows</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>This is common knowledge, yet strangely every time I rebuild my work PC (which is too often! Gah!) I try and Google the location of Registry keys and folders and always, always get a bum-steer. So here, have another (bum-steer?) version of this hack on the Net.


<!--more-->

</p>
<ul>
	<li>Registry key to hack: <strong>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\ CurrentVersion\Authentication\LogonUI\ Background</strong>
(you can stick this in a .reg file and Import from regedit.exe):</li>

</ul>

<p style="padding-left:60px;"><code>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\Background]

"OEMBackground"=dword:00000001</code></p>



<ul>
	<li>Directory to place your background image:</li>
</ul>

<p style="padding-left:60px;"><code><strong>C:\Windows\System32\oobe\info\backgrounds</strong></code></p>

<p style="padding-left:60px;">Call the image "<strong>backgroundDefault.jpg</strong>"</p>



<ul>
	<li>The image must be JPEG format, and total size &lt; 256KiB</li>
	<li>You can test straight away with Ctl+Alt+Del -- no need to reboot or logoff.</li>
</ul>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2012/02/13/install-emacs24-snapshot-on-debian-ubuntu-and-windows-7.html">Install Emacs24 Snapshot on Debian, Ubuntu and Windows 7</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-02-13T11:15:29+11:00">2012-02-13 11:15</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2012/02/13/install-emacs24-snapshot-on-debian-ubuntu-and-windows-7.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/debian.html" rel="tag">debian</a></li>
           <li><a class="tag p-category" href="../categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="../categories/emacs24.html" rel="tag">emacs24</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/tips.html" rel="tag">tips</a></li>
           <li><a class="tag p-category" href="../categories/ubuntu.html" rel="tag">ubuntu</a></li>
           <li><a class="tag p-category" href="../categories/windows.html" rel="tag">windows</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>I just can't wait for <a title="An overview of what's coming in Emacs 24" href="http://www.masteringemacs.org/articles/2011/12/06/what-is-new-in-emacs-24-part-1/">Emacs24</a> to be released! (I know, it's in beta and it'll be officially released Real Soon Now, but my catalyst is Technomancy's ESK2 which is such an improvement over ESK1, and it needs Emacs 24).


In <a title="Build/Install emacs 24 on debian" href="http://sinewalker.wordpress.com/2012/01/15/build-and-install-emacs24-on-debian-squeeze/">my last post</a> I had steps to build emacs from source-code. This is worth following for hacker cred, but it soon gets tedious if you have a lot of systems to put emacs on. As pointed out by a few readers, there are some snapshot builds available for different platforms. This post lists steps for installing the pre-built snapshots, for the three operating systems that I use.



<!--more-->



</p>
<h3>Debian</h3>

As pointed out earlier, you can get <a href="http://emacs.naquadah.org/">emacs-snapshot builds for Debian</a> from Julien Danjou (of <a href="http://awesome.naquadah.org">awesome</a> fame). That page does have instructions, but I'll list them here anyway:



<ol>
 <li>Import the key (this is a one-line pipeline, broken for display only):
<pre>

$ <strong>wget -q -O - http://emacs.naquadah.org/key.gpg 

| sudo apt-key add -</strong>



</pre>
 </li>
 <li>Add the snapshot repository to your <strong><code>/etc/apt/sources.list</code></strong> (by hand). Here's Julien's "stable" snapshot:
<pre>

deb http://emacs.naquadah.org/ stable/

deb-src http://emacs.naquadah.org/ stable/



</pre>
 </li>
 <li>Update your package database
<pre>

$ <strong>sudo aptitude update</strong>



</pre>
 </li>
 <li>Install emacs-snapshot
<pre>

$ <strong>sudo aptitude install <code>emacs-snapshot</code></strong>



</pre>
 </li>
</ol>



<h3>Ubuntu</h3>

I'm running Ubuntu 11.10 in a VirtualBox on work's Windows 7 machine. As mentioned at Julien Danjou's page,

Damien Cassou makes a version of the same emacs-snapshot for Ubuntu, which is hosted <a title="emacs-snapshot PPA for ubuntu" href="https://launchpad.net/~cassou/+archive/emacs">at Launchpad</a>. You add it and install simalarly:



<ol>
 <li>Add the PPA (Personal Package Archive). This also imports the key:
<pre>

$ <strong>sudo add-apt-repository ppa:cassou/emacs</strong>



</pre>
 </li>
 <li>Update your package database
<pre>

$ <strong>sudo apt-get update</strong>



</pre>
 </li>
 <li>Install emacs-snapshot
<pre>

$ <strong>sudo apt-get install emacs-snapshot</strong>



</pre>
 </li>
</ol>



<h3>Windows</h3>

It's handy to have a native Windows emacs as well as the one in the VM. Of course being Windows, it's more complicated to install and configure... This has been tested on Windows 7:



<ol>
 <li>Download the latest PKZIP-ed binary from <a href="http://code.google.com/p/emacs-for-windows/updates/list">Google Code</a>
</li>
 <li>Unpack the ZIP (Windows Explorer <em>can</em> open ZIP files -- but <a href="http://www.7-zip.org">7zip</a> is mich nicer). I like to unpack emacs in <code><strong>c:\Applications\emacs</strong></code><em>&lt;version&gt;</em> so I can maintain several different versions at once</li>
 <li>(<em>optional</em>) Put a windows symlink to the version of emacs you want to use.  This assumes your C: drive is formatted with NTFS, which on most Windows systems it is. The symlink can then be used for your %PATH% later and you won't have to edit the variable again to change versions, which for some odd reason is a convoluted operation in Windows... Type the following in a <strong>CMD.EXE</strong> prompt:
<pre>

C:\&gt; <strong>CD C:\Applications</strong>

C:\Applications\&gt; <strong>MKLINK /D emacs emacs</strong><em>&lt;version&gt;</em>



</pre>
 </li>
 <li>Create an <em>Environment Variable</em> called <code><strong>%HOME%</strong></code> that refers to your Windows home directory (<code>C:\Users\</code><em>&lt;username&gt;</em>). This is so that you can put your <code>.emacs.d</code> in your home directory, and Emacs will find it:
 <ol type="a">
  <li>Open <strong>Windows Explorer</strong>
</li>
  <li>Right-click on "<strong>My Computer</strong>", choose "<strong>Properties</strong>"</li>
  <li>Choose "<strong>Advance system settings</strong>" (Really? what's so advanced about an environment variable?)</li>
  <li>Make sure the "<strong>Advanced</strong>" tab of the <strong>System Properties</strong> dialog is selected, then press the "<strong>Environment Variables...</strong>" button</li>
  <li>Press the top "<strong>New...</strong>" button (to add a personal variable, rather than system variable)</li>
  <li>in the "<strong>Variable name:</strong>" field, enter <code><strong>HOME</strong></code>. In the "<strong>Variable value:</strong>" field, put <code><strong>%USERPROFILE%</strong></code>, press "<strong>OK</strong>" button</li>
  <li>Press the other "<strong>OK</strong>" button to dismiss the Environment Varables dialog</li>
  <li>Press yet another "<strong>OK</strong>" button to dismiss the System Properties dialog</li>
 </ol>
 </li>
 <li>Put emacs in your <code><strong>%PATH%</strong></code>. Use the same steps above to edit the Sytem variable PATH and add the path to Emacs (<code><strong>;C:\Applications\emacs\bin</strong></code> if you put a symlink in step 3)</li>
</ol>



<h3>Personal Emacs settings</h3>

You can now put your emacs settings into <code>~/.emacs.d</code> (that's <code>%HOME%\.emacs.d</code> for Windows). I highly recommend <a title="Technomany's home" href="http://technomancy.us/">Technomancy</a>'s <a title="GitHub ESK2 branch" href="https://github.com/technomancy/emacs-starter-kit">Emacs Starter Kit</a> (version 2).



My own<code> ~/.emacs.d/init.el</code> is set up to bootstrap ESK2 and a few favourite packages, just as Technomancy describes. 



One package I'd like to mention here is "<a href="http://xahlee.org/emacs/ergonomic_emacs_keybinding.html">ergoemacs-keybindings</a>" which gives more modern/ergonomic key bindings to emacs. Together with cua-mode, it makes Emacs behave very nicely. Currently though I notice there's a problem loading the package (maybe it's autoloads aren't right yet?) So I have to hack it as described in the package's README, (with a hard-coded path to the package directory, that'll break if I update it in the future because it has the package version) but I hope to fix it and send a patch for Xah Real Soon Now...  In the mean-time, here's a snippet:




~~~~~~~~~~~~{.clojure}


;;;; egroemacs keybindings

(setenv "ERGOEMACS_KEYBOARD_LAYOUT" "dv") ; US Dvorak (Ergonomic)



;; FIX: for some reason the library isn't loading from the package? 

;;      Have to put full path to the load file, which is brittle

(when (package-installed-p 'ergoemacs-keybindings)
  (load-file "~/.emacs.d/elpa/ergoemacs-keybindings-5.3.9/ergoemacs-keybindings.el")
  (ergoemacs-mode 1)
  (cua-mode 1))

~~~~~~~~~~~~




(btw, the lisp-ish CSH above is done by using WordPress' sourcecode block and specifying "clojure" for the language)
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2012/01/15/build-and-install-emacs24-on-debian-squeeze.html">Build and install Emacs24 on Debian squeeze</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-01-15T22:57:54+11:00">2012-01-15 22:57</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2012/01/15/build-and-install-emacs24-on-debian-squeeze.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/build-deps.html" rel="tag">build-deps</a></li>
           <li><a class="tag p-category" href="../categories/debian.html" rel="tag">debian</a></li>
           <li><a class="tag p-category" href="../categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/how-to.html" rel="tag">how-to</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>Hacking in Debian is so easy (one of the reasons I switched). Take, for instance, building Emacs. This is such a piece of cake compared to the weird hoops you have to go through to get all the build dependencies on other platforms. It's something I never tried before, simply because it was too daunting trying to figure out all the packages I need to install. But apt-get has this awesome --build-deps switch...
<!--more-->

So then, how to build and install Emacs 24 on Debian squeeze, in 6 easy steps?  Since Emacs24 is not yet released, there isn't a package for it in Debian (which is why I'm building my own). But I figured that the build dependencies would not have changed too much from Emacs23, so I used that, and it worked.

</p>
<ol>
 <li> Install the build dependencies:
 <pre><code> 
   # <strong>apt-get build-dep emacs23</strong></code></pre>
<br>
  This installs all the compilers, parsers, development libraries and other parts of the GNU toolchain that is needed to build the emacs23 package.
 </li>
 <li> Download the source code. I used the <a href="https://github.com/emacsmirror/emacs">GitHub mirror</a> of the official GNU <a href="http://savannah.gnu.org/projects/emacs/">Savana codebase</a>, and downloaded the newest PKzip archive from there.  There is probably a newer one now. Purists probably would check-out direct from either Savana or GitHub rather than download a zip archive... I'm not going to hack emacs itself though, so I don't care.<br>
 </li>
 <li> Unzip the archive and generate the configure script (the autogen step is skipped in the INSTALL file by the way, good thing I've <a href="http://airs.com/ian/configure/configure_3.html#SEC16">done my homework</a>):
 <pre><code>
   $ <strong>unzip emacsmirror-emacs-EMACS_PRETEST_24_9_92-295-g2dccfc4.zip</strong>
   $ <strong>cd emacsmirror-emacssnapshot</strong>
   $ <strong>./autogen.sh
 </strong></code></pre>
<br>
 </li>
 <li>Follow the INSTALL instructions:<br>
 <pre><code>
   $ <strong>./configure</strong>
   $ <strong>make</strong>
 </code></pre>
<br>
 </li>
 <li>Test it (Note:- if you watch the build, you'll see that after the C core of emacs is built, emacs itself is used to compile the elisp components, so building also makes a fairly good test of the C parts anyway):<br>
  <pre><code>
   $ <strong>src/emacs -Q</strong>
  </code></pre>
<br>
 </li>
 <li> If okay, install it:
  <pre><code>
   # <strong>make install</strong>
  </code></pre>
<br>
 </li>
</ol>


            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2012/01/11/implementing-a-caching-only-dns-on-debian.html">Implementing a caching-only DNS on Debian</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-01-11T14:35:59+11:00">2012-01-11 14:35</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2012/01/11/implementing-a-caching-only-dns-on-debian.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/dns.html" rel="tag">DNS</a></li>
           <li><a class="tag p-category" href="../categories/bind.html" rel="tag">bind</a></li>
           <li><a class="tag p-category" href="../categories/debian.html" rel="tag">debian</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/network.html" rel="tag">network</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>After 3 years of sticking with Novell, I recently switched away from openSUSE to <a title="Debian GNU/Linux" href="http://www.debian.org" target="_blank">Debian</a>. There are a few reasons why, but I won't bore you with them. So far I'm liking it. There are a few things to set up before I settle in, and one is slow DNS lookup.


<!--more-->



I described how and why to make a <a title="Implementing a caching-only DNS on openSUSE" href="http://sinewalker.wordpress.com/2010/07/20/implementing-a-caching-only-dns-on-opensuse/">caching-only DNS on openSUSE</a> in July 2010.  In Debian it's a little different:

</p>
<ol>
	<li>Install bind of course. The package is called <em>bind9 </em>and installs itself as a service and starts automatically, no need to mess with runlevels:
         <div>
          <code>
# <strong>aptitude install bind9</strong>


          </code>
         </div>
        </li>
	<li>The config for bind in Debian is a subdirectory structure in <code>/etc/bind</code>.  For a simple caching-only server, you leave /etc/bind/named.conf untouched and instead change <code><strong>/etc/bind/named.conf.options</strong></code> to have your <em>forwarders</em>:
        <div>
          <code>
// MJL20120111 - Adding Google2, OpenDNS1, gateway

forwarders {
    8.8.4.4; 208.67.222.222; 192.168.1.1;
};


          </code>
         </div>
        </li>
	<li>Restart bind to load the new configuration:
         <div>
          <code>
# <strong>service bind9 restart</strong>


          </code>
         </div>
        </li>
	<li>You will need to change your network to use the local bind. I used <a title="NetworkManager's home page" href="http://projects.gnome.org/NetworkManager/">NetworkManager</a> on the GNOME desktop, but you can just edit <strong><code>/etc/resolv.conf</code></strong>:
         <div>
          <code>
nameserver 127.0.0.1 #local bind


          </code>
         </div>
If you edit the file by hand, you'll have to restart the network somehow (haven't found out how yet, except with NetworkManager).</li>
	<li>Done. Test it:
         <div>
          <code>
$ <strong>nslookup australia.gov.au</strong>

Server:127.0.0.1

Address:127.0.0.1#53Non-authoritative answer:

Name:australia.gov.au

Address: 205.239.168.12


          </code>
         </div>
        </li>
</ol>

All good, and much faster. Happy surfing.
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2011/12/15/blogging-with-emacs-org-mode.html">Blogging with Emacs Org Mode</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2011-12-15T21:53:00+11:00">2011-12-15 21:53</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2011/12/15/blogging-with-emacs-org-mode.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/emacs-org-mode-blogging-code.html" rel="tag">emacs org-mode blogging code</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>My blog is really in need of some love. One of the reasons I'm not posting very frequently (apart from just not having much to say or making time to say it) is that it is such a pain to write posts in WordPress' built in editor.  I briefly considered editing in a text editor and then cut/pasting, but usually there's a mess to clean up anyway, so it's not much fun either. </p> 


<!--more-->

<p> I recently started looking for ways to blog offline in emacs and then publish posts up to WordPress. I won't say I was surprised to find more than one solution, but it was pleasant nonetheless… :) </p> <p> The one I'm using to write this post with is a package called <a href="https://github.com/punchagan/org2blog">org2blog</a>. It supports WordPress posts via it's XML RPC interface and can publish to as many different WordPress blogs as you like.  This suits me because I also have an internal work blog at HP (they use WordPress MU, so it'll be interesting to find out how/if that works). </p> <p> You can configure it fairly easily with some elisp. Here's mine: </p>    



[sourcecode language="text" light="true" highlight="12"]

;; Note - I installed org2blog with ELPA from Marmalade, so this

;; `require' declaration is probably just documentation



(require 'org2blog-autoloads)



(setq org2blog/wp-blog-alist
       '(("sinewalker"
          :url "http://sinewalker.wordpress.com/xmlrpc.php"
          :username "sinewalker"
          :default-categories ("hacking")
          :tags-as-categories nil
          :wp-code t)
         ("hp-hacks"
          :url "http://blogs.hp.com/hphacks/xmlrpc.php"
          :username "michael.lockhart@hp.com"
          :track-posts "~/Documents/blogs/hp-hacks/posts.log")))
~~~~~~~~~~~~


     <p> Note that the directive on line 12 is what causes the code above to be encased in Wordpress' <a href="http://en.support.wordpress.com/code/posting-source-code/">sourcecode shortcut</a>.  In my org version of this post, the code is surrounded by "#+BEGIN_SRC emacs-lisp" and "#+END_SRC", which allows me to edit in emacs using emacs-lisp-mode, right inline of the rest of this post. Unfortunately the sourcecode shortcut in Wordpress doesn't understand emacs lisp, so there's no syntax highlighting. </p> <p> There are still some things for me to figure out (such as how to mark code within the text of a paragraph, as above), but already this is looking a lot better. </p> 
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="2011/11/30/curious-cursor-complication-with-emacs-and-windows-magnifier.html">Curious cursor complication with Emacs and Windows Magnifier</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2011-11-30T14:17:06+11:00">2011-11-30 14:17</time>
                </div>
                <div class="stats">
                            <div class="g-commentcount" data-href="/blog/2011/11/30/curious-cursor-complication-with-emacs-and-windows-magnifier.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


                </div>
                        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/bug.html" rel="tag">bug</a></li>
           <li><a class="tag p-category" href="../categories/cursor.html" rel="tag">cursor</a></li>
           <li><a class="tag p-category" href="../categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="../categories/hacking.html" rel="tag">hacking</a></li>
           <li><a class="tag p-category" href="../categories/magnifier.html" rel="tag">magnifier</a></li>
           <li><a class="tag p-category" href="../categories/registry.html" rel="tag">registry</a></li>
           <li><a class="tag p-category" href="../categories/windows.html" rel="tag">windows</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <p>I recently noticed a bug when you start GNU Emacs win32 <em>after</em> starting <a title="Microsoft: Make items on the screen appear bigger (Magnifier)" href="http://windows.microsoft.com/en-AU/windows7/Make-items-on-the-screen-appear-bigger-Magnifier">Windows Magnifier</a>: Emacs' cursor becomes a single-pixel "caret" instead of the box cursor. This makes the cursor very hard to find.
<!--more-->

I usually leave Emacs' cursor at the default (<code>box</code>) because this is so much easier to see, especially if you also enable <code>blink-cursor-mode</code> (though<a title="How to stop blinking cursors" href="http://www.jurta.org/en/prog/noblink"> that's a matter of taste</a>, I suppose). The default settings also set the cursor to a <code>hollow</code> box when the <code>window</code> (or the entire <a title="Emacs frames and windows" href="http://emacsworld.blogspot.com/2008/08/emacs-frames-and-windows.html"><code>frame</code></a>) is inactive.



Really, a text editor is unusable with a "caret" or bar-shaped cursor.



The following behaviors are observed with this bug:

</p>
<ul>
	<li>This affects at least GNU Emacs versions 23.1 <a title="Download GNU Emacs for Windows, from GNU FTP site" href="http://ftp.gnu.org/pub/gnu/emacs/windows/">for Windows</a>, and <a title="GNU Emacs 24 win32 pre-built binaries at Google Code" href="http://code.google.com/p/emacs-for-windows/downloads/list">24.0 compiled</a> with mingw for win32</li>
	<li>The actual shape of the cursor has no correspondence with the value of the <code>cursor-type</code> variable: it is always as-if the value were <code>(bar . 1)</code> (a vertical bar, one pixel wide)</li>
	<li>The cursor blinks, whether you have enabled <code>blink-cursor-mode</code> or not</li>
	<li>The value of the Windows Registry key <strong><code>HKCU\Control Panel\Desktop\CaretWidth</code></strong> also has no bearing on the cursor shape (though this key is great for setting the cursor thickness in other Windows programs...)</li>
	<li>(This one took me ages to find) <span style="text-decoration:underline;">It only happens if Windows Magnifier is running</span> <em>before</em> you start Emacs. If you start Emacs first, and <em>then</em> start Magnifier, the cursor is unchanged and respects the value of <code>cursor-type</code>
</li>
</ul>

So, the work-around for this is to start Emacs before you run Magnifier (especially: make sure the Windows Accessibility feature that starts Magnifier when you log in, is turned OFF).



<a title="Search GNU Bugtracker for emacs cursor bugs" href="http://debbugs.gnu.org/cgi/pkgreport.cgi?include=subject%3Acursor;package=emacs">As far as I can tell</a>, there is no bug report for this.  I may file one when I get around to figuring out <a title="GNU Bugtracker home" href="http://debbugs.gnu.org/">GNU's bug-tracker</a>.
            </div>
        </div>
            <nav class="postindexpager">
        <ul class="pager">
            <li class="next">
                <a href="index-8.html" rel="next">Older posts</a>
            </li>
        </ul>
        </nav>

            

                    <footer id="footer" role="contentinfo">
            <p></p>
<hr>Contents Copyright © 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a> 2005 — 2015         <a href="mailto:sinewalker@gmail.com">Mike Lockhart</a>. Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> with <a href="https://github.com/getnikola/nikola-themes/tree/master/v7/zen-ipython">Zen-IPython</a> theme.
            
        </footer>

        </div>
    </section>
    
    
                <script src="../assets/js/all-nocdn.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
