<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Loading SSH keys at KDE startup | Milosophical Me</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#e37f2a;">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://milosophical.me/blog/2015/loading-ssh-keys-at-kde-startup.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Michael Lockhart">
<link rel="prev" href="4-bit-rules-of-computing-part-2.html" title="4-bit Rules of Computing, Part 2" type="text/html">
<link rel="next" href="resetting-firefox.html" title="Resetting Firefox" type="text/html">
<meta property="og:site_name" content="Milosophical Me">
<meta property="og:title" content="Loading SSH keys at KDE startup">
<meta property="og:url" content="http://milosophical.me/blog/2015/loading-ssh-keys-at-kde-startup.html">
<meta property="og:description" content="It's really handy to have all my SSH authentication be passwordless, but in a secure way. In openSUSE, the ssh-agent is started for you automatically, but you still need to add your identities manuall">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-11-04T21:33:18+11:00">
<meta property="article:tag" content="howto">
<meta property="article:tag" content="KDE">
<meta property="article:tag" content="ssh">
<meta property="article:tag" content="tip">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://milosophical.me/">

                <span id="blog-title">Milosophical Me</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../index.html">Blog</a>
                </li>
<li>
<a href="../../archive/archive.html">Archive</a>
                </li>
<li>
<a href="../../tags/index.html">Tags</a>
                </li>
<li>
<a href="../../pg/index.html">Codex</a>
                </li>
<li>
<a href="../../pixels/index.html">Pixels</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Social <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://plus.google.com/+MichaelLockhart/posts">Microblog</a>
                    </li>
<li>
<a href="https://gist.github.com/sinewalker">Gists - social code</a>
                    </li>
<li>
<a href="https://www.facebook.com/sinewalker">Facebook</a>
                    </li>
<li>
<a href="mailto:sinewalker@gmail.com">Email</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Code <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://github.com/sinewalker">GitHub</a>
                    </li>
<li>
<a href="https://gist.github.com/sinewalker">Gists</a>
                    </li>
<li>
<a href="https://bitbucket.com/sinewalker">Bitbucket</a>
                    </li>
<li>
<a href="https://codepen.io/sinewalker/">Codepen</a>
                    </li>
<li class="active">
<a href="#"> <span class="sr-only">(active)</span></a>
                    </li>
<li>
<a href="https://sourceforge.net/u/sinewalker/profile/">SourceForge</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://about.me/mikelockhart">About.me</a>
                    </li>
<li>
<a href="../../pg/colophon.html">About this site</a>
                    </li>
<li>
<a href="https://calendar.google.com/calendar/embed?src=sinewalker@gmail.com&amp;ctz=Australia/Sydney/">My calendar</a>
                    </li>
<li>
<a href="https://www.linkedin.com/in/mikelockhart">LinkedIn</a>
                    </li>
<li>
<a href="http://stackoverflow.com/users/776953/mike">Stack Overflow</a>
            </li>
</ul>
</li>
<li>
<a href="../../rss.xml">RSS</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form navbar-right" role="search">
<input type="hidden" name="sites" value="http://milosophical.me/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="form-control"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="loading-ssh-keys-at-kde-startup.ipynb" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Loading SSH keys at KDE startup</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/michael-lockhart.html">Michael Lockhart</a>
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-11-04T21:33:18+11:00" itemprop="datePublished" title="2015-11-04 21:33">2015-11-04 21:33</time></a></p>
            
        <p class="sourceline"><a href="loading-ssh-keys-at-kde-startup.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's really handy to have all my SSH authentication be passwordless, but in a secure way. In openSUSE, the <code>ssh-agent</code> is started for you automatically, but you still need to add your identities manually (and enter passphrases when you do this).  That's a bit of a pain to do every time you login.</p>
<p>Here are some simple scripts and steps I use to set up my KDE session so that it will automatically load my SSH identities when I login.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<!-- TEASER_END -->
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are three parts for this:</p>
<ol>
<li>
<strong>Set up KDE's KWallet</strong> with a master password.  KWallet will be remembering the passphrases for my SSH keys (as well as other passwords within KDE such as those for web sites visited with Konqueror and Chrome, or email passwords, SQL Connections and so on).  This makes it so that I only have to remember the KWallet master password to open my wallet at login, not all the different passphrases (you should use a different passphrase for each SSH key pair)</li>
<li>
<strong>Start <code>ssh-add</code> at login</strong>, using the KDE password tool <code>ksshaskpass</code> to ask for the passphrases (and that will save them to my wallet)</li>
<li>
<strong>Automatically load all my SSH identities</strong> (I have several, for work and for different code hosting systems on the net:  bitbucket and github)</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting-up-KWallet">Setting up KWallet<a class="anchor-link" href="loading-ssh-keys-at-kde-startup.html#Setting-up-KWallet">¶</a>
</h3>
<p>You should only need to do this once:</p>
<ol>
<li>Launch "KDE Wallet Configuration" (press <strong>Alt-F2</strong> or whichever shortcun runs <strong>KRunner</strong> in your setup) type <strong>wallet</strong> and pick the configuration tool from the list</li>
<li>Make sure <strong>Enable the KDE wallet subsystem</strong> is checked</li>
<li>
<strong>Launch Wallet Manager</strong> and create a new wallet if you need to, setting the passphrase. <em>This is the one you need to remember and type every time you login to KDE</em>
</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting-up-ssh-add">Setting up <code>ssh-add</code><a class="anchor-link" href="loading-ssh-keys-at-kde-startup.html#Setting-up-ssh-add">¶</a>
</h3>
<p>I use this script:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">export</span> <span class="nv">SSH_ASKPASS</span><span class="o">=</span>/usr/lib/ssh/ksshaskpass
/usr/bin/ssh-add
</pre></div>
<p>Save this script to a location you keep your shell scripts, <code>chmod +x</code> it so it is executable. Then, it needs to be run automatically at KDE Startup. For this, you add it to the KDE Autostarts.</p>
<ol>
<li>Launch the "Autostart" KDE Control Module (<strong>Alt-F2</strong>, <strong>Autostart</strong>)</li>
<li>Add a new Script File linking to where you saved the above script</li>
</ol>
<p>From now on, every time you start KDE, it'll run <code>ssh-add</code> and set it's password tool to be the KDE graphical password tool, <code>ksshaskpass</code>. That in turn uses KWallet for password storage, so if you need a password that's in the wallet, it'll retrieve it from there.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Adding-my-SSH-identities-at-login">Adding my SSH identities at login<a class="anchor-link" href="loading-ssh-keys-at-kde-startup.html#Adding-my-SSH-identities-at-login">¶</a>
</h3>
<p>I use a second script:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Finds all private key files (that are protected, based on mode bits) </span>
<span class="c1"># and adds each to ssh agent</span>
<span class="k">for</span> filename in ~/.ssh/*<span class="p">;</span> <span class="k">do</span>
  <span class="nv">perms</span><span class="o">=</span><span class="k">$(</span>stat <span class="nv">$filename</span><span class="p">|</span>sed -n <span class="s1">'/^Access: (/{s/Access: (\([0-9]\+\).*$/\1/;p}'</span><span class="k">)</span>

  <span class="nv">filetype</span><span class="o">=</span><span class="k">$(</span>file <span class="nv">$filename</span><span class="k">)</span>

  <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$perms</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"0600"</span> <span class="o">&amp;&amp;</span> <span class="s2">"</span><span class="nv">$filetype</span><span class="s2">"</span> <span class="o">==</span> *<span class="s2">"private key"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    ssh-add <span class="nv">$filename</span>
  <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
<p>This one will pick out all the private keys from my SSH directory <code>~/.ssh</code>, adding them to my SSH agent's keychain.</p>
<p>Add this to Autostart as another Script File. I've saved it as <code>~/.ssh/addkeys</code>.</p>
<p>You need to <code>chmod +x addkeys</code> and run it once to add all the keys and enter their passphrases (so that they get added to your Wallet).</p>
<p>Once the script has been run, whenever I need to login to an SSH session, if the identity is already in the agent's chain, I can get in without needing to type the passphrase.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So now that my wallet is set up, the two scripts are in place at Autostart, and I've run the <code>addkeys</code> script at least once to add the passphrasses to my wallet, I never need to enter passwords or passphrases when SSHing again (unless keys change or it's a new host).</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/howto.html" rel="tag">howto</a></li>
            <li><a class="tag p-category" href="../../tags/kde.html" rel="tag">KDE</a></li>
            <li><a class="tag p-category" href="../../tags/ssh.html" rel="tag">ssh</a></li>
            <li><a class="tag p-category" href="../../tags/tip.html" rel="tag">tip</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="4-bit-rules-of-computing-part-2.html" rel="prev" title="4-bit Rules of Computing, Part 2">Previous post</a>
            </li>
            <li class="next">
                <a href="resetting-firefox.html" rel="next" title="Resetting Firefox">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-yYfngbEKv4RENfGDvNUqJTqGFcKf31NJEe9OTnnMH3Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article>
</div>
        <!--End of body content-->

        <footer id="footer"><hr>Contents Copyright © 
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a>
 2005 — 2018         <a href="mailto:sinewalker@gmail.com">Michael Lockhart</a>. Powered by <a href="https://getnikola.com" rel="nofollow"><img src="../../img/nikola.png" alt="Nikola"></a>, <a href="https://github.com/syl20bnr/spacemacs"><img src="https://cdn.rawgit.com/syl20bnr/spacemacs/442d025779da2f62fc86c2082703697714db6514/assets/spacemacs-badge.svg" alt="built with Spacemacs"></a>

            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-65364237-1', 'auto');  ga('send', 'pageview');</script>
</body>
</html>
