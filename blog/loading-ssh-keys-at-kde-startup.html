<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Loading SSH keys at KDE startup | Milosophical Me</title>

                <link href="../assets/css/bitter.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/main.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

      <link rel="canonical" href="http://milosophical.me/blog/loading-ssh-keys-at-kde-startup.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    

    
    <meta name="author" content="Mike Lockhart">
        <meta property="og:site_name" content="Milosophical Me">
    <meta property="og:title" content="Loading SSH keys at KDE startup">
    <meta property="og:url" content="http://milosophical.me/blog/loading-ssh-keys-at-kde-startup.html">
    <meta property="og:description" content="It's really handy to have all my SSH authentication be passwordless, but in a secure way. In openSUSE, the ssh-agent is started for you automatically, but you still need to add your identities manuall">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2015-11-04T21:33:18+11:00">
           <meta property="article:tag" content="KDE">
           <meta property="article:tag" content="howto">
           <meta property="article:tag" content="ssh">
           <meta property="article:tag" content="tip">

    
    

</head>
<body>
    <section class="social">
        <ul>
                    <li><a href="../index.html" title="Home"><i class="icon-compass"></i></a></li>
            <li><a href="../archive/archive.html" title="Archive"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../tags/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../pg/index.html" title="Codex"><i class="icon-book"></i></a></li>
            <li><a href="../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://plus.google.com/+MichaelLockhart/posts" title="Microblog"><i class="icon-google-plus"></i></a></li>
            <li><a href="https://www.linkedin.com/in/mikelockhart" title="My LinkedIn profile"><i class="icon-linkedin"></i></a></li>
            <li><a href="https://bitbucket.com/sinewalker" title="My Bitbucket"><i class="icon-bitbucket"></i></a></li>
            <li><a href="https://github.com/sinewalker" title="My Github"><i class="icon-github"></i></a></li>
            <li><a href="http://stackoverflow.com/users/776953/mike" title="Stack Overflow"><i class="icon-stackexchange"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Loading SSH keys at KDE startup</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2015-11-04T21:33:18+11:00">2015-11-04 21:33</time>
            
                      |  
        <a href="loading-ssh-keys-at-kde-startup.ipynb" id="sourcelink">Source</a>

            </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../tags/kde.html" rel="tag">KDE</a></li>
           <li><a class="tag p-category" href="../tags/howto.html" rel="tag">howto</a></li>
           <li><a class="tag p-category" href="../tags/ssh.html" rel="tag">ssh</a></li>
           <li><a class="tag p-category" href="../tags/tip.html" rel="tag">tip</a></li>
        </ul>
        </div>

        </div>
        <div class="body">
            <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's really handy to have all my SSH authentication be passwordless, but in a secure way. In openSUSE, the <code>ssh-agent</code> is started for you automatically, but you still need to add your identities manually (and enter passphrases when you do this).  That's a bit of a pain to do every time you login.</p>
<p>Here are some simple scripts and steps I use to set up my KDE session so that it will automatically load my SSH identities when I login.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<!-- TEASER_END -->
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are three parts for this:</p>
<ol>
<li>
<strong>Set up KDE's KWallet</strong> with a master password.  KWallet will be remembering the passphrases for my SSH keys (as well as other passwords within KDE such as those for web sites visited with Konqueror and Chrome, or email passwords, SQL Connections and so on).  This makes it so that I only have to remember the KWallet master password to open my wallet at login, not all the different passphrases (you should use a different passphrase for each SSH key pair)</li>
<li>
<strong>Start <code>ssh-add</code> at login</strong>, using the KDE password tool <code>ksshaskpass</code> to ask for the passphrases (and that will save them to my wallet)</li>
<li>
<strong>Automatically load all my SSH identities</strong> (I have several, for work and for different code hosting systems on the net:  bitbucket and github)</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="setting-up-kwallet">Setting up KWallet</h3>
<p>You should only need to do this once:</p>
<ol>
<li>Launch "KDE Wallet Configuration" (press <strong>Alt-F2</strong> or whichever shortcun runs <strong>KRunner</strong> in your setup) type <strong>wallet</strong> and pick the configuration tool from the list</li>
<li>Make sure <strong>Enable the KDE wallet subsystem</strong> is checked</li>
<li>
<strong>Launch Wallet Manager</strong> and create a new wallet if you need to, setting the passphrase. <em>This is the one you need to remember and type every time you login to KDE</em>
</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="setting-up-ssh-add-">Setting up <code>ssh-add</code>
</h3>
<p>I use this script:</p>
<pre><code class="language-bash"><span class="shebang">#!/bin/sh</span>
export SSH_ASKPASS=/usr/lib/ssh/ksshaskpass
/usr/bin/ssh-add
</code></pre>
<p>Save this script to a location you keep your shell scripts, <code>chmod +x</code> it so it is executable. Then, it needs to be run automatically at KDE Startup. For this, you add it to the KDE Autostarts.</p>
<ol>
<li>Launch the "Autostart" KDE Control Module (<strong>Alt-F2</strong>, <strong>Autostart</strong>)</li>
<li>Add a new Script File linking to where you saved the above script</li>
</ol>
<p>From now on, every time you start KDE, it'll run <code>ssh-add</code> and set it's password tool to be the KDE graphical password tool, <code>ksshaskpass</code>. That in turn uses KWallet for password storage, so if you need a password that's in the wallet, it'll retrieve it from there.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="adding-my-ssh-identities-at-login">Adding my SSH identities at login</h3>
<p>I use a second script:</p>
<pre><code class="language-bash"><span class="shebang">#!/bin/bash</span>
<span class="comment"># Finds all private key files (that are protected, based on mode bits) </span>
<span class="comment"># and adds each to ssh agent</span>
<span class="keyword">for</span> filename <span class="keyword">in</span> ~/.ssh/*; <span class="keyword">do</span>
  perms=$(stat $filename|sed -n <span class="string">'/^Access: (/{s/Access: (\([0-9]\+\).*$/\1/;p}'</span>)

  filetype=$(file $filename)

  <span class="keyword">if</span> <span class="test_condition">[[ <span class="string">"$perms" == "0600" &amp;&amp; "$filetype"</span> == *<span class="string">"private key"</span> ]]</span>; <span class="keyword">then</span>
    ssh-add <span class="variable">$filename</span>
  <span class="keyword">fi</span>
<span class="keyword">done</span>
</code></pre>
<p>This one will pick out all the private keys from my SSH directory <code>~/.ssh</code>, adding them to my SSH agent's keychain.</p>
<p>Add this to Autostart as another Script File. I've saved it as <code>~/.ssh/addkeys</code>.</p>
<p>You need to <code>chmod +x addkeys</code> and run it once to add all the keys and enter their passphrases (so that they get added to your Wallet).</p>
<p>Once the script has been run, whenever I need to login to an SSH session, if the identity is already in the agent's chain, I can get in without needing to type the passphrase.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So now that my wallet is set up, the two scripts are in place at Autostart, and I've run the <code>addkeys</code> script at least once to add the passphrasses to my wallet, I never need to enter passwords or passphrases when SSHing again (unless keys change or it's a new host).</p>
</div>
</div>
</div>
    </div>
  </div>

        </div>
                <ul class="pager">
            <li class="previous">
                <a href="4-bit-rules-of-computing-part-2.html" rel="prev" title="4-bit Rules of Computing, Part 2">Previous post</a>
            </li>
            <li class="next">
                <a href="resetting-firefox.html" rel="next" title="Resetting Firefox">Next post</a>
            </li>
        </ul>

                    <script src="https://apis.google.com/js/plusone.js"></script>
<div class="g-comments" data-href="http://milosophical.me/blog/loading-ssh-keys-at-kde-startup.html" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD">
</div>


    </div>
                    <footer id="footer" role="contentinfo">
            <p></p>
<hr>Contents Copyright © 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a> 2005 — 2015         <a href="mailto:sinewalker@gmail.com">Mike Lockhart</a>. Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> with <a href="https://github.com/getnikola/nikola-themes/tree/master/v7/zen-ipython">Zen-IPython</a> theme.
            
        </footer>

        </div>
    </section>
    <script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-65364237-1', 'auto');  ga('send', 'pageview');</script>
    
                <script src="../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
            <script src="../assets/js/jquery.timeago.js" type="text/javascript"></script>
        <script src="../assets/js/mathjax.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
